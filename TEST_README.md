# PPDataæµ‹è¯•è„šæœ¬ä½¿ç”¨è¯´æ˜

## æ–‡ä»¶è¯´æ˜

### 1. `run_test_ppdata_simple.py`
ç®€åŒ–çš„æµ‹è¯•è„šæœ¬ï¼Œæ”¯æŒä¿å­˜å’ŒåŠ è½½æµ‹è¯•ç»“æœ

### 2. `scripts/GPT2_PPData_test_simple.sh`
æµ‹è¯•å¯åŠ¨è„šæœ¬

## ä¸»è¦åŠŸèƒ½

### âœ… æ¨¡å‹æ¨ç†
- åŠ è½½è®­ç»ƒå¥½çš„LLAMAæ¨¡å‹
- åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œé¢„æµ‹
- è‡ªåŠ¨å¤„ç†bfloat16ç±»å‹è½¬æ¢
- æ”¯æŒGPU/CPUè¿è¡Œ

### âœ… æ•°æ®å¤„ç†
- æ­£ç¡®å¤„ç†å¤šå˜é‡é¢„æµ‹ï¼ˆ43ä¸ªç‰¹å¾ï¼‰
- è‡ªåŠ¨é‡å¡‘æ•°æ®ç»´åº¦
- å½’ä¸€åŒ–æ•°æ®åå˜æ¢

### âœ… ç»“æœä¿å­˜/åŠ è½½ï¼ˆæ–°åŠŸèƒ½ï¼‰
- **è‡ªåŠ¨ä¿å­˜æ¨ç†ç»“æœ**ï¼šé¿å…é‡å¤è¿è¡Œæ¨¡å‹
- **å¿«é€ŸåŠ è½½å·²æœ‰ç»“æœ**ï¼šç›´æ¥ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
- ä¸¤ç§ç»“æœæ–‡ä»¶ï¼š
  - `*_inference.npz`ï¼šåŸå§‹æ¨ç†ç»“æœï¼ˆç”¨äºå¿«é€ŸåŠ è½½ï¼‰
  - `*_results.npz`ï¼šå®Œæ•´ç»“æœï¼ˆåŒ…å«æ‰€æœ‰æŒ‡æ ‡å’Œåå½’ä¸€åŒ–æ•°æ®ï¼‰

### âœ… å¯è§†åŒ–
ç”Ÿæˆ6ç§å¯¹æ¯”å›¾ï¼š
1. å¤šç‰¹å¾å½’ä¸€åŒ–æ•°æ®å¯¹æ¯”
2. å¤šç‰¹å¾åŸå§‹å°ºåº¦æ•°æ®å¯¹æ¯”
3. å¤šæ ·æœ¬å½’ä¸€åŒ–æ•°æ®å¯¹æ¯”
4. å¤šæ ·æœ¬åŸå§‹å°ºåº¦æ•°æ®å¯¹æ¯”
5. å½’ä¸€åŒ–vsåŸå§‹å°ºåº¦å¹¶æ’å¯¹æ¯”
6. è¯¯å·®åˆ†å¸ƒç›´æ–¹å›¾

### âœ… è¯„ä¼°æŒ‡æ ‡
- å½’ä¸€åŒ–æ•°æ®ï¼šMSE, MAE, RMSE
- åŸå§‹å°ºåº¦æ•°æ®ï¼šMSE, MAE, RMSE

## ä½¿ç”¨æ–¹æ³•

### ç¬¬ä¸€æ¬¡è¿è¡Œï¼ˆå®Œæ•´æ¨ç†ï¼‰

```bash
bash ./scripts/GPT2_PPData_test_simple.sh
```

**æ­¥éª¤**ï¼š
1. åŠ è½½æ¨¡å‹å’Œæ•°æ®
2. è¿è¡Œæ¨ç†ï¼ˆ~2åˆ†é’Ÿï¼‰
3. ä¿å­˜åŸå§‹æ¨ç†ç»“æœåˆ° `test_results/PPData_PPData_90_6_6_inference.npz`
4. æ•°æ®é‡å¡‘å’Œåå½’ä¸€åŒ–
5. è®¡ç®—æŒ‡æ ‡
6. ç”Ÿæˆ6å¼ å¯è§†åŒ–å›¾è¡¨
7. ä¿å­˜å®Œæ•´ç»“æœåˆ° `test_results/PPData_PPData_90_6_6_results.npz`

### åç»­è¿è¡Œï¼ˆåŠ è½½å·²æœ‰ç»“æœï¼‰

å¦‚æœä½ å·²ç»è¿è¡Œè¿‡ä¸€æ¬¡æµ‹è¯•ï¼Œæƒ³è¦é‡æ–°ç”Ÿæˆå›¾è¡¨æˆ–æŸ¥çœ‹ç»“æœï¼Œå¯ä»¥ç›´æ¥åŠ è½½å·²ä¿å­˜çš„æ¨ç†ç»“æœï¼š

```bash
python run_test_ppdata_simple.py \
  --task_name short_term_forecast \
  --root_path ./dataset/ \
  --data_path PPData.csv \
  --model_id PPData_90_6 \
  --model GPT2 \
  --data PPData \
  --features M \
  --freq 's' \
  --seq_len 90 \
  --label_len 6 \
  --pred_len 6 \
  --factor 3 \
  --enc_in 43 \
  --dec_in 43 \
  --c_out 43 \
  --llm_model LLAMA \
  --llm_dim 4096 \
  --des 'Power plant data' \
  --llm_layers 6 \
  --d_model 16 \
  --d_ff 32 \
  --batch_size 24 \
  --model_comment GPT2-PPData \
  --checkpoint_path "./checkpoints/your_checkpoint_path/checkpoint" \
  --plot_samples 5 \
  --plot_features 3 \
  --load_results ./test_results/PPData_PPData_90_6_6_inference.npz
```

**ä¼˜ç‚¹**ï¼š
- âš¡ è·³è¿‡æ¨¡å‹åŠ è½½å’Œæ¨ç†ï¼ˆèŠ‚çœ~3-4åˆ†é’Ÿï¼‰
- ğŸ”„ å¯ä»¥è°ƒæ•´å¯è§†åŒ–å‚æ•°ï¼ˆ`--plot_samples`, `--plot_features`ï¼‰
- ğŸ“Š å¿«é€Ÿé‡æ–°ç”Ÿæˆå›¾è¡¨

## è¾“å‡ºæ–‡ä»¶

### `./test_results/` ç›®å½•ç»“æ„

```
test_results/
â”œâ”€â”€ PPData_PPData_90_6_6_inference.npz          # åŸå§‹æ¨ç†ç»“æœï¼ˆåŠ è½½ç”¨ï¼‰
â”œâ”€â”€ PPData_PPData_90_6_6_results.npz            # å®Œæ•´ç»“æœï¼ˆæ‰€æœ‰æŒ‡æ ‡ï¼‰
â”œâ”€â”€ PPData_PPData_90_6_scaled_features.png      # å›¾1ï¼šå½’ä¸€åŒ–å¤šç‰¹å¾
â”œâ”€â”€ PPData_PPData_90_6_original_features.png    # å›¾2ï¼šåŸå§‹å°ºåº¦å¤šç‰¹å¾
â”œâ”€â”€ PPData_PPData_90_6_scaled_samples.png       # å›¾3ï¼šå½’ä¸€åŒ–å¤šæ ·æœ¬
â”œâ”€â”€ PPData_PPData_90_6_original_samples.png     # å›¾4ï¼šåŸå§‹å°ºåº¦å¤šæ ·æœ¬
â”œâ”€â”€ PPData_PPData_90_6_comparison.png           # å›¾5ï¼šå¹¶æ’å¯¹æ¯”
â””â”€â”€ PPData_PPData_90_6_error_distribution.png   # å›¾6ï¼šè¯¯å·®åˆ†å¸ƒ
```

## å¯è°ƒå‚æ•°

åœ¨ `scripts/GPT2_PPData_test_simple.sh` ä¸­ï¼š

- `checkpoint_path`: æ¨¡å‹checkpointè·¯å¾„ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
- `--plot_samples 5`: ç»˜åˆ¶æ ·æœ¬æ•°é‡
- `--plot_features 3`: ç»˜åˆ¶ç‰¹å¾æ•°é‡
- `--use_gpu`: ä½¿ç”¨GPUï¼ˆåˆ é™¤æ­¤è¡Œåˆ™ä½¿ç”¨CPUï¼‰
- `--batch_size 24`: æ‰¹æ¬¡å¤§å°

## Bugä¿®å¤è¯´æ˜

### 1. ä¿®å¤reshapeé”™è¯¯
**é—®é¢˜**ï¼šæ•°æ®ç»´åº¦è®¡ç®—é”™è¯¯ï¼Œ`12168 â‰  43 Ã— 282`
**è§£å†³**ï¼š
- æ·»åŠ æ•°æ®éªŒè¯å’Œè°ƒæ•´
- æ­£ç¡®çš„reshapeæ“ä½œï¼šsqueeze â†’ reshape â†’ transpose
- è¯¦ç»†çš„å½¢çŠ¶æ‰“å°ä¿¡æ¯

### 2. æ·»åŠ ä¿å­˜/åŠ è½½åŠŸèƒ½
**æ–°å¢å‚æ•°**ï¼š
- `--load_results`: åŠ è½½å·²ä¿å­˜çš„æ¨ç†ç»“æœ
- `--save_results`: è‡ªåŠ¨ä¿å­˜æ¨ç†ç»“æœï¼ˆé»˜è®¤å¼€å¯ï¼‰

**å·¥ä½œæµç¨‹**ï¼š
```
é¦–æ¬¡è¿è¡Œ: æ¨¡å‹æ¨ç† â†’ ä¿å­˜inference.npz â†’ å¤„ç† â†’ ä¿å­˜results.npz â†’ ç”Ÿæˆå›¾è¡¨
åç»­è¿è¡Œ: åŠ è½½inference.npz â†’ å¤„ç† â†’ ä¿å­˜results.npz â†’ ç”Ÿæˆå›¾è¡¨
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šreshapeé”™è¯¯
**ç—‡çŠ¶**ï¼š`ValueError: cannot reshape array`
**è§£å†³**ï¼šè„šæœ¬ä¼šè‡ªåŠ¨è°ƒæ•´æ•°æ®å¤§å°ï¼Œå¦‚æœçœ‹åˆ°è­¦å‘Šä¿¡æ¯ï¼Œæ£€æŸ¥æ•°æ®å®Œæ•´æ€§

### é—®é¢˜2ï¼šdtypeä¸åŒ¹é…
**ç—‡çŠ¶**ï¼š`RuntimeError: Input type ... and weight type ... should be the same`
**è§£å†³**ï¼šç¡®ä¿ä½¿ç”¨ `--use_gpu` å‚æ•°ï¼ˆGPUä¸Šä¼šè‡ªåŠ¨è½¬æ¢ä¸ºbfloat16ï¼‰

### é—®é¢˜3ï¼šæ¨¡å‹æ¶æ„ä¸åŒ¹é…
**ç—‡çŠ¶**ï¼š`Missing key(s) in state_dict`
**è§£å†³**ï¼šç¡®ä¿ `--llm_model LLAMA` å‚æ•°æ­£ç¡®ï¼ˆä¸æ˜¯GPT2ï¼‰

## æ€§èƒ½æç¤º

- **é¦–æ¬¡è¿è¡Œæ—¶é—´**ï¼š~5-6åˆ†é’Ÿï¼ˆæ¨¡å‹åŠ è½½2åˆ†é’Ÿ + æ¨ç†2åˆ†é’Ÿ + å¤„ç†1åˆ†é’Ÿï¼‰
- **åŠ è½½ç»“æœæ—¶é—´**ï¼š~1åˆ†é’Ÿï¼ˆä»…æ•°æ®å¤„ç†å’Œå¯è§†åŒ–ï¼‰
- **å†…å­˜éœ€æ±‚**ï¼š~8GB GPU / ~16GB RAMï¼ˆCPUæ¨¡å¼ï¼‰

## ç¤ºä¾‹è¾“å‡º

```
================================================================================
TEST RESULTS
================================================================================

Scaled Data Metrics (Normalized):
  MSE:  0.0123456
  MAE:  0.0987654
  RMSE: 0.1111111

Original Scale Metrics:
  MSE:  123.4567890
  MAE:  9.8765432
  RMSE: 11.1111111

Data shapes:
  Predictions: (283, 6, 43)
  Ground truth: (283, 6, 43)
================================================================================

âœ“ Final results saved to ./test_results/PPData_PPData_90_6_6_results.npz
  - To reload inference results next time, use: --load_results ./test_results/PPData_PPData_90_6_6_inference.npz
```

## æ›´æ–°æ—¥å¿—

### v2.0 (å½“å‰ç‰ˆæœ¬)
- âœ… ä¿®å¤å¤šå˜é‡æ•°æ®reshapeé”™è¯¯
- âœ… æ·»åŠ æ¨ç†ç»“æœä¿å­˜/åŠ è½½åŠŸèƒ½
- âœ… æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ•°æ®éªŒè¯
- âœ… æ·»åŠ è¯¦ç»†çš„å½¢çŠ¶ä¿¡æ¯æ‰“å°

### v1.0
- åˆå§‹ç‰ˆæœ¬
- åŸºæœ¬æ¨ç†å’Œå¯è§†åŒ–åŠŸèƒ½
